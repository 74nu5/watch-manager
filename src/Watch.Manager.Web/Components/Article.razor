<FluentCard Width="400px" Class="article-card">
    <a href="@(this.ArticleModel.Url.ToString())" target="_blank">
        <div class="article-card-header">
            <img src="@($"{this.ApiUrl}/api/articles/thumbnail/{this.ArticleModel.Id}.png?api-version=1.0")"  alt="@(this.ArticleModel.Title)" crossorigin="anonymous" height="200" />
            <h3 class="article-card-title">@(this.ArticleModel.Title)</h3>
        </div>
    </a>
    <FluentBadge Circular="true" Appearance="Appearance.Neutral">
        @(this.ArticleModel.AnalyzeDate.ToLocalTime().ToString("F"))
    </FluentBadge>

    <p>
        @if (this.showMore)
        {
            <p>@(new MarkupString(this.GetFullMarkdownContent(this.ArticleModel.Summary)))</p>
            <FluentButton Appearance="Appearance.Neutral" Size="ButtonSize.Small" @onclick="this.ToggleShowMore" IconStart="@(new Size20.ArrowCollapseAll())">Voir moins</FluentButton>
        }
        else
        {
            <p>@(new MarkupString(this.GetShortMarkdownContent(this.ArticleModel.Summary)))</p>
            <FluentButton Appearance="Appearance.Neutral" Size="ButtonSize.Small" @onclick="this.ToggleShowMore" IconStart="@(new Size20.ArrowExpandAll())">Voir plus</FluentButton>
        }
    </p>

    @* Section Classification IA *@
    @if (showClassification)
    {
        <ArticleClassification ArticleId="@ArticleModel.Id" OnCategoryAssigned="@OnCategoryAssignedAsync" />
    }
    else
    {
        <div style="margin: 8px 0;">
            <FluentButton Appearance="Appearance.Stealth"
                         @onclick="() => showClassification = true"
                         IconStart="@(new Size20.Bot())"
                         Title="Afficher la classification IA">
                Classifier avec l'IA
            </FluentButton>
        </div>
    }

    <p>
        @foreach (var tag in this.ArticleModel.Tags)
        {
            <a href="@($"/?tag={tag}")"><FluentBadge Appearance="Appearance.Accent">@tag</FluentBadge></a>
        }
    </p>

    @* Affichage des catégories assignées *@
    @if (this.ArticleModel.Categories.Count > 0)
    {
        <div style="margin: 8px 0;">
            <span style="font-size: 0.9em; color: var(--neutral-foreground-rest); margin-right: 8px;">📁 Catégories:</span>
            @foreach (var category in this.ArticleModel.Categories)
            {
                <FluentBadge Appearance="Appearance.Neutral" BackgroundColor="#3498db" Color="white" style="margin-right: 4px;">@category</FluentBadge>
            }
        </div>
    }
    <FluentStack Orientation="Orientation.Vertical" HorizontalAlignment="HorizontalAlignment.SpaceBetween" VerticalAlignment="VerticalAlignment.SpaceBetween">
        @foreach (var author in this.ArticleModel.Authors)
        {
            <FluentPersona Id="@($"persona-{author.Replace(" ", string.Empty)}")"
                           Name="@author"
                           ImageSize="30px"
                           StatusSize="PresenceBadgeSize.Small">
            </FluentPersona>@*
                        <FluentTooltip Anchor="@($"persona-{author.Replace(" ", string.Empty)}")" >@author</FluentTooltip> *@
        }
        <FluentAnchor Href="@this.ArticleModel.Url.ToString()" Target="_blank" IconStart="@(new Size20.Globe())">@(this.ArticleModel.Url.Host)</FluentAnchor>
    </FluentStack>
</FluentCard>
